# Диагностические маршруты

Все диагностические ручки доступны только администраторам. Для доступа
используйте заголовок `x-admin-token` или параметр строки запроса
`token` с валидным админ-токеном.

## `GET /admin/selftest`

Прогоняет self-test и проверяет ключевые интеграции (OpenAI, Telegram,
хранилище). Возвращает `200 OK` с результатами проверки.

## `GET /admin/envz`

Выводит информацию о том, какие переменные окружения заданы и проходят
минимальные проверки формата.

## `GET /admin/diag`

Универсальная диагностическая ручка. Через параметр `q` выбирается тип
проверки. Сейчас поддерживается `q=bindings` для проверок D1 и KV,
используемых в обработчике.

## `GET /admin/known-users/clear`

Сбрасывает in-memory кэш UTM-источников известных пользователей.
Возвращает JSON-ответ `{ "ok": true, "cleared": <количество записей> }`,
где `cleared` — число удалённых записей.
