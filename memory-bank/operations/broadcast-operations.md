# Broadcast Operations Guide

## –ü–∞–º—è—Ç–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
- –ú–æ–¥–µ–ª—å —Ä–∞—Å—Å—ã–ª–∫–∏: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ plain text —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–ª–æ–∂–µ–Ω–∏–π –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ D1 (`messages`/`users`) –ø–æ distinct `chat_id`; —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è, —è–∑—ã–∫–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ env‚Äë–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`BROADCAST_RECIPIENTS`) –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.
- –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `/broadcast` –∏–∑ whitelisted –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞. –í–∞—Ä–∏–∞–Ω—Ç—ã `/admin broadcast` –∏–ª–∏ –≤—ã–∑–æ–≤—ã –∏–∑ HTTP-—Ä–æ—É—Ç–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω—ã.
- –î–∏–∞–ª–æ–≥ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ –¥–≤–∞ —à–∞–≥–∞: 
  1. `/broadcast` ‚Üí –≤—ã–±–æ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (`/everybody` –∏–ª–∏ —Å–ø–∏—Å–æ–∫ user_id/username, –¥—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è, `not_found` –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–µ–∑—é–º–µ).
  2. ¬´–®–∞–≥‚ÄØ2¬ª ‚Üí —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏. –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ 1000‚ÄØ–º—Å —à–ª–∞–≥–±–∞—É–º: –±–æ—Ç –∂–¥—ë—Ç, –ø–æ–∫–∞ Telegram –¥–æ—Å—Ç–∞–≤–∏—Ç –≤—Å–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ –∏ –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –∏ –¥–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø–æ—Ä—Ü–∏—é. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–∞–Ω–¥–æ–π `/send`, –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —É—Ö–æ–¥–∏—Ç –≤—Å–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∞–¥—Ä–µ—Å–∞—Ç–∞–º —á–µ—Ä–µ–∑ `minimal-broadcast-service`.
- –ï—Å–ª–∏ Telegram –ø—Ä–∏—Å–ª–∞–ª –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —ç—Ç–æ –æ–∫–Ω–æ (—á–∞—Å—Ç–æ –ø—Ä–∏ –∫–æ–ø–∏–ø–∞—Å—Ç–µ –¥–ª–∏–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –∏–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π —Å–µ—Ç–∏), –±–æ—Ç –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –≤–≤–æ–¥, —Å–æ–æ–±—â–∞–µ—Ç ¬´–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚Äî —Ç–µ–∫—Å—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–Ω–æ–≤–æ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å /new_text.¬ª –∏ –ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ.
- `/send` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ª—é–±–æ–π –≤–µ—Ä—Å–∏–∏ —Ç–µ–∫—Å—Ç–∞; `/new_text` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ —à–∞–≥—É –≤–≤–æ–¥–∞, –∞ `/cancel_broadcast` –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–µ–Ω—é –¥–∏–∞–ª–æ–≥–∞ –±–µ–∑ —Ä–∞—Å—Å—ã–ª–∫–∏.
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏; –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –í—Å–µ —Å–æ–±—ã—Ç–∏—è (`broadcast_resolve`, `broadcast_summary`, `text-gate_rejected`) –∏ –∏—Ç–æ–≥ `broadcast:last` (TTL 7 –¥–Ω–µ–π) —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ KV/–ª–æ–≥–∞—Ö.
- –°–æ–±–ª—é–¥–∞–µ–º –ª–∏–º–∏—Ç—ã Telegram –∏–∑ –ø–∞–º—è—Ç–∫–∏ [`memory-bank/references/telegram-broadcast.md`](../references/telegram-broadcast.md) –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—Å—ã–ª–∫—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–µ–π/–ª–∏–º–∏—Ç–µ—Ä–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–µ–ª–∏–∑–∞.
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Ö–≤–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ webhook –∏ `/broadcast`: [`memory-bank/logs/diag-2025-11-30-broadcast-webhook.md`](../logs/diag-2025-11-30-broadcast-webhook.md#tail-—É—Å–ø–µ—à–Ω–æ–≥–æ-webhook-–∏-broadcast).

### 2025-11-20 ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞
- –ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â—ë–Ω –∫ –∫–æ–º–º–∏—Ç—É `f0bfa1b02a8b84227ad5d2d21908573334e7763f` (PR #306), –≥–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–µ–±–∞—É–Ω—Å —Ç–µ–∫—Å—Ç–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ `/send` –∏ `/cancel_broadcast`.
- –ë–æ–µ–≤–æ–π —Ç–µ—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, —á—Ç–æ —à–ª–∞–≥–±–∞—É–º —Ç–µ–∫—Å—Ç–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ `/send` —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –≤ —Ä–µ–ª–∏–∑–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –æ—Ç–¥–µ–ª—å–Ω—ã–π `AGENTS.md` –¥–æ–±–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ò–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞: –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–π –ª–∏–º–∏—Ç Telegram, –±–æ—Ç –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–≤–∞–∂–¥—ã. –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –º–∞–π–ª—Å—Ç–æ—É–Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∏.

## –ö–æ–Ω—Ç—É—Ä –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞—Å—Å—ã–ª–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Telegram-–∫–æ–º–∞–Ω–¥—É `/broadcast` –≤–Ω—É—Ç—Ä–∏ –≤–æ—Ä–∫–µ—Ä–∞.
- –ö–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ whitelisted –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏–∑ –±–∏–Ω–¥–∏–Ω–≥–∞ `ADMIN_TG_IDS`.
- –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π Telegram-–∞–¥–∞–ø—Ç–µ—Ä. –ö–æ–º–∞–Ω–¥–∞ `/broadcast` –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É –∏ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –≤ —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ `waitUntil`. –û—á–µ—Ä–µ–¥–∏, scheduler –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-—Å—Ç–æ—Ä —É–¥–∞–ª–µ–Ω—ã.
- –ü–æ—Ä—Ç—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã: –¥–∏–∞–ª–æ–≥–æ–≤—ã–π –∫–∞–Ω–∞–ª (`messaging`) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç typing –∏ –æ—Ç–≤–µ—Ç—ã –º–æ–¥–µ–ª–∏ —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º, –∞ —Ä–∞—Å—Å—ã–ª–æ—á–Ω—ã–π –∫–∞–Ω–∞–ª (`messagingBroadcast`) —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π rate limiter –∏–∑ `BROADCAST_MAX_PARALLEL`/`BROADCAST_MAX_RPS`. –ï—Å–ª–∏ –æ–±–∞ –ø–æ—Ä—Ç–∞ –¥–µ–ª—è—Ç –æ–¥–∏–Ω –∞–¥–∞–ø—Ç–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ–±—ã –¥–∏–∞–ª–æ–≥–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∂–¥–∞–ª–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ —Ä–∞—Å—Å—ã–ª–æ–∫.

## –§–ª–∞–≥–∏ –∏ —Ç–æ–∫–µ–Ω—ã
- `TELEGRAM_BOT_TOKEN` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
- `ADMIN_TG_IDS` ‚Äî KV-namespace —Å whitelisted Telegram ID (`{"whitelist":["123","456"]}` –∏–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç). –¢–æ–ª—å–∫–æ —ç—Ç–∏ ID –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞—Å—Å—ã–ª–∫–∏.
- `BROADCAST_ENABLED` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `/broadcast` –≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é; —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É, —è–≤–Ω–æ
  —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ ¬´0¬ª/`false`.

## –°—Ü–µ–Ω–∞—Ä–∏–π `/broadcast`
1. –û—Ç whitelisted –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç `/broadcast` ‚Üí –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç ¬´–®–∞–≥‚ÄØ1‚Ä¶¬ª –∏ –∂–¥—ë—Ç `/everybody` –∏–ª–∏ —è–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ user_id/username (—á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª/–∑–∞–ø—è—Ç—É—é). –î—É–±–ª–∏–∫–∞—Ç—ã –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–¥—Ä–µ—Å–∞—Ç–æ–≤ –±–æ—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤ —Ä–µ–∑—é–º–µ, –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É.
2. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –±–æ—Ç –æ–±—ä—è–≤–ª—è–µ—Ç ¬´–®–∞–≥‚ÄØ2¬ª –∏ –∂–¥—ë—Ç —Ç–µ–∫—Å—Ç (–¥–æ 3970 –≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤). –õ—é–±–æ–π –∫–æ—Ä–æ—Ç–∫–∏–π –∏–ª–∏ –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ 1000‚ÄØ–º—Å –æ–∫–Ω–æ –æ–∂–∏–¥–∞–Ω–∏—è: –ø–æ–∫–∞ Telegram –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç –¥–æ—Å—Ç–∞–≤–∫—É, –±–æ—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä. –ï—Å–ª–∏ –≤ –æ–∫–Ω–µ –ø–æ—è–≤–∏–ª—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç, –±–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –∫–Ω–æ–ø–∫–∏-–ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ `/send`, `/new_text`, `/cancel_broadcast`.
3. –ï—Å–ª–∏ Telegram –¥—Ä–æ–±–∏—Ç –≤–≤–æ–¥ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π, –±–æ—Ç —É–≤–µ–¥–æ–º–ª—è–µ—Ç ¬´—Ç–µ–∫—Å—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω¬ª –∏ –ø—Ä–æ—Å–∏—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —à–∞–≥ —Ç–µ–∫—Å—Ç–∞. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ –∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —à–ª–∞–≥–±–∞—É–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å `/send`.
4. `/send` –≤—Å–µ–≥–¥–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—É. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø—É—Å–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ (—á–µ—Ä–µ–∑ `waitUntil`), –±–æ—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ KV –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç ¬´‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!¬ª. `/new_text` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –±–µ–∑ –≤—ã—Ö–æ–¥–∞, –∞ `/cancel_broadcast` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞—Ç –≤ —à—Ç–∞—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º –∏ –æ—á–∏—â–∞–µ—Ç pending-—Å–µ—Å—Å–∏—é.

### 2025-11-30 ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —à–∞–≥–∞ –ú8.–®1
Tail [`diag-2025-11-30-broadcast-webhook.md`](../logs/diag-2025-11-30-broadcast-webhook.md#tail-—É—Å–ø–µ—à–Ω–æ–≥–æ-webhook-–∏-broadcast) —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `/broadcast ‚Üí /everybody ‚Üí —Ç–µ–∫—Å—Ç ‚Üí /send` —Å —É—Å–ø–µ—à–Ω—ã–º —à–ª–∞–≥–±–∞—É–º–æ–º (1000‚ÄØ–º—Å –æ–∫–Ω–æ, –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–∞–∫–µ—Ç), `broadcast recipients resolved (source=d1, recipients>0)` –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π `broadcast pool completed`. –≠—Ç–æ—Ç —Ö–≤–æ—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –ú8.–®1 (–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –Ω–æ–≤—ã–º —à–ª–∞–≥–±–∞—É–º–æ–º –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ `/send`/`/new_text`/`/cancel_broadcast`) –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

## –®–ª–∞–≥–±–∞—É–º —Ç–µ–∫—Å—Ç–∞
**–¶–µ–ª—å:** –∏—Å–∫–ª—é—á–∏—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏ –ø–æ–π–º–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ Telegram —Ä–∞–∑–±–∏–≤–∞–µ—Ç –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

**–®–∞–≥ –ê ‚Äî —Ç–µ–∫—Å—Ç.** –ü–æ—Å–ª–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ ¬´–®–∞–≥ 2‚Ä¶¬ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ pending-—Å–æ—Å—Ç–æ—è–Ω–∏–∏ –Ω–∞ 1000‚ÄØ–º—Å –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø—Ä–∏—à–µ–¥—à–∏–µ –≤ —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª. –ï—Å–ª–∏ Telegram –ø–µ—Ä–µ–¥–∞–ª –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (`Telegram ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π ‚áí –æ—Ç–∫–∞–∑`), –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –æ—à–∏–±–∫–æ–π ¬´–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚Äî —Ç–µ–∫—Å—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–Ω–æ–≤–æ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å /new_text.¬ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –Ω–∞—á–∞–ª—É —à–∞–≥–∞ –ê.

**–®–∞–≥ –ë ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.** –ï—Å–ª–∏ –≤ 1000‚ÄØ–º—Å –æ–∫–Ω–µ –ø—Ä–∏—à—ë–ª –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `/send`. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `/send` —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Ö–æ–¥–∏—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

- `/new_text` ‚Äî –æ—Ç–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ –∫ —à–∞–≥—É –ê –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è.
- `/cancel_broadcast` ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –æ—á–∏—Å—Ç–∫–æ–π pending-–∑–∞–ø–∏—Å–∏ –∏ –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–∞–Ω–∞–ª–æ–≥ —Å—Ç–∞—Ä–æ–≥–æ `/cancel`).

**–ü—Ä–∞–≤–∏–ª–æ:** –ø–æ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª `/send`, —Ä–∞—Å—Å—ã–ª–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π. `/send` –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é —Ç–µ–∫—Å—Ç–∞, —Å–æ–±—Ä–∞–Ω–Ω—É—é –≤ —à–∞–≥–µ –ê, –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º `/broadcast` —à–ª–∞–≥–±–∞—É–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ.

### –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏—ë–º–∫–∏ –∑–∞–ø—É—Å–∫–∞
- –í tail –µ—Å—Ç—å `broadcast recipients resolved` —Å `source=d1` –∏ `recipients>0` (–ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±–æ—Ä–∫–∞ –∏–∑ D1 –∑–∞–ø–æ–ª–Ω–µ–Ω–∞).
- –ü–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç –º–∏–Ω–∏–º—É–º N —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –∏–∑ D1) **–ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ whitelisted –æ–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–∏–ª `/send`.
- KV-–ª–æ–≥ pending-—Å–µ—Å—Å–∏–∏ –æ—á–∏—â–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–Ω–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –∫–ª—é—á–µ–π `broadcast:pending:*`).
- –û—Ç–¥–µ–ª—å–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≥–æ–Ω —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —à–ª–∞–≥–±–∞—É–º–∞: –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/send`, –∞ –ø—Ä–∏ –∏–º–∏—Ç–∞—Ü–∏–∏ –¥–≤—É—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ 1000‚ÄØ–º—Å –æ—Ç–≤–µ—á–∞–µ—Ç –æ—à–∏–±–∫–æ–π ¬´–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ ‚Äî —Ç–µ–∫—Å—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω‚Ä¶¬ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ —à–∞–≥—É –ê.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –¥–æ 3970 –≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ—Ä–æ–≥ –≤ –∫–æ–¥–µ; —Ç–µ–∫—Å—Ç—ã –∫–æ—Ä–æ—á–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `/broadcast`). –ë–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –Ω—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é.
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏: –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ ‚â§28 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ (–∂—ë—Å—Ç–∫–∏–π –ø—Ä–µ–¥–µ–ª ‚âà30/—Å–µ–∫) –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–º–ø —Ä–∞—Å—Å—ã–ª–∫–∏. –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞—à–∏—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ (`BROADCAST_MAX_RPS=28` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—É–ª–∞.
- –ö–æ–Ω—Ç—Ä–æ–ª—å 28/s –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–º `minimal-broadcast-service` —Å `maxRps=28` –∏ `retry_after=1s`; –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≥–æ–Ω—è–π—Ç–µ `npx vitest run broadcast --reporter basic --silent` (–∏–ª–∏ –±–µ–∑ `--reporter`), —Ç.–∫. `--reporter dot` –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ Vitest –ø–∞–¥–∞–µ—Ç `RangeError` –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–≥—Ä–µ—Å—Å–∏–µ–π —Å–µ—Ä–≤–∏—Å–∞.
- –ù–∞ –∫–∞–∂–¥—ã–π —á–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ –±–æ–ª–µ–µ 1 —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥—É; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏.
- –í —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –≤–ª–æ–∂–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ plain text/—ç–º–æ–¥–∑–∏.
- –ö–æ–º–∞–Ω–¥–∞ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–Ω–µ whitelist: –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç `forbidden`/`access denied` –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç.
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `/broadcast` —Ç—Ä–µ–±—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã –∏ —Ç–µ–∫—Å—Ç–∞; –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π –Ω–µ—Ç.

#### –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç–µ—Ä —Ä–∞—Å—Å—ã–ª–∫–∏
- –ê–∫—Ç–∏–≤–µ–Ω –æ–±—â–∏–π rate limiter –Ω–∞ 28 RPS —Å –¥–∂–∏—Ç—Ç–µ—Ä–æ–º, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—É–ª–∞ (`BROADCAST_MAX_RPS` = 28 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–∂–∏—Ç—Ç–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `BROADCAST_RATE_JITTER_RATIO`).
- –õ–∏–º–∏—Ç–µ—Ä –≤–∫–ª—é—á—ë–Ω –≤ –ø—Ä–æ–¥-—Ä–µ–∂–∏–º–µ –∏ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫–æ –≤—Å–µ–º —Ä–µ–∂–∏–º–∞–º —Ä–∞—Å—Å—ã–ª–∫–∏; –Ω–æ–≤—ã–µ —Ñ–∏—á–∏/–∞–ø–≥—Ä–µ–π–¥—ã –æ–±—è–∑–∞–Ω—ã –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –ª–∏–±–æ —è–≤–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—ë –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ª–∏–º–∏—Ç–µ—Ä–∞ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª, —á—Ç–æ–±—ã downstream‚Äë—Ñ–∏—á–∏ –Ω–µ –æ–±—Ö–æ–¥–∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏.

### –£–ø—Ä–∞–≤–ª—è–µ–º—ã–π –ø—É–ª –æ—Ç–ø—Ä–∞–≤–æ–∫ (2025-11-24)
- `minimal-broadcast-service` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É–ª. –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `poolSize=4`, `maxAttempts=3`, `baseDelayMs=1000`, `jitterRatio=0.2`, `maxRps=28`, `rateJitterRatio=0.1` (–≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ `BROADCAST_MAX_PARALLEL`, `BROADCAST_BASE_DELAY_MS`, `BROADCAST_JITTER_RATIO`, `BROADCAST_MAX_RPS`, `BROADCAST_RATE_JITTER_RATIO`).
- –ü—Ä–∏ `429 Too Many Requests` —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `retry_after` (–µ—Å–ª–∏ Telegram –≤–µ—Ä–Ω—É–ª –µ–≥–æ) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É `retry_after` –∏ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –±—ç–∫–æ—Ñ—Ñ–æ–º.
- –õ–æ–≥–∏ Cloudflare:
  - `broadcast pool initialized` ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `requestedBy`, `recipients`, `poolSize`, `maxAttempts`, `baseDelayMs`, `jitterRatio`, `maxRps`, `rateJitterRatio`.
  - `broadcast throttled` ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º `429`, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `attempt`, `delayMs`, `retryAfterMs` –∏ `poolSize`.
  - `broadcast pool completed` ‚Äî –∏—Ç–æ–≥ —Ä–∞—Å—Å—ã–ª–∫–∏: `delivered`, `failed`, `throttled429`, `durationMs`.
- –ò—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤ (–≤–∫–ª—é—á–∞—è `delivered`, `failed`, `throttled429`, `durationMs`, `requestedBy`, —Å—Ç–∞—Ç—É—Å `ok/aborted`) –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ
  `GET /admin/diag?q=broadcast` —Å –≤–∞–ª–∏–¥–Ω—ã–º `ADMIN_TOKEN` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –∑–∞–ø—É—Å–∫–æ–≤ –∏ –ø–æ–º–æ–≥–∞–µ—Ç —Å–≤–µ—Ä–∏—Ç—å tail –±–µ–∑
  –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º.
- –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞—Å—Å—ã–ª–æ–∫ –ø–µ—Ä—Å–∏—Å—Ç—è—Ç—Å—è –≤ KV `BROADCAST_TELEMETRY_KV` –∫–ª—é—á–∞–º–∏ `broadcast:telemetry:<env>:<workerId>` (env –±–µ—Ä—ë—Ç—Å—è –∏–∑ `ENVIRONMENT_VERSION`/`CONFIG_VERSION`/`WORKER_VERSION`, workerId –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Ä–∫–µ—Ä–∞). TTL –∑–∞–ø–∏—Å–µ–π ‚Äî 7 —Å—É—Ç–æ–∫. –≠–Ω–¥–ø–æ–∏–Ω—Ç `/admin/diag?q=broadcast` –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ KV –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ in-memory –∫—ç—à–∞, –ø–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –∏–ª–∏ –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –≤–∏–¥–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏.
- –ê–≤–∞—Ä–∏–π–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –µ—Å–ª–∏ Telegram —Ç—Ä–µ–±—É–µ—Ç `retry_after ‚â•5‚ÄØ—Å` (–ø–æ—Ä–æ–≥ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏—Å—Ö–æ–¥—è –∏–∑ `BROADCAST_MAX_RPS`) –∏–ª–∏
  –æ–±—â–∏–π `sendText` –ø–∞–¥–∞–µ—Ç —Å —Ñ–∞—Ç–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–æ–π (`401`, `5xx`, —Å–µ—Ç–µ–≤–æ–π —Å–±–æ–π). –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø—É–ª –ª–æ–≥–∏—Ä—É–µ—Ç `broadcast pool aborted`,
  –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Å—Ç–∞—Ç—É—Å `BroadcastAborted`, –∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´‚ùå –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞¬ª.
- –î–ª—è –ü–†–û–í–ï–†–ö–ò 7.1 –∏—Å–ø–æ–ª—å–∑—É–µ–º ‚â•10 –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π, —Å–º–æ—Ç—Ä–∏–º `poolSize` –∏ `throttled429` –≤ —Ö–≤–æ—Å—Ç–µ `wrangler tail`, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –æ–∂–∏–¥–∞–µ–º—ã–º –±—ç–∫–æ—Ñ—Ñ–æ–º.

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ pending-—Å–µ—Å—Å–∏–π (2025-11-26)
- –ü—Ä–æ–±–ª–µ–º–∞: –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –≤–æ—Ä–∫–µ—Ä–∞ –º–µ–∂–¥—É `/broadcast` –∏ —Ç–µ–∫—Å—Ç–æ–º —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–µ—Å—Å–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–ª–∞—Å—å, –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–ª–µ—Ç–∞–ª–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–ª–æ–≥ (–∞–¥–º–∏–Ω –≤–∏–¥–µ–ª typing/–æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏, –Ω–æ —Ä–∞—Å—Å—ã–ª–∫–∞ –Ω–µ —É—Ö–æ–¥–∏–ª–∞).
- –†–µ—à–µ–Ω–∏–µ: `telegram-broadcast-command` —Ö—Ä–∞–Ω–∏—Ç –æ–∂–∏–¥–∞—é—â–∏–π —Ç–µ–∫—Å—Ç –Ω–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º `Map`, –∞ –≤ –æ–±—â–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–º –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é –≤–æ—Ä–∫–µ—Ä–∞. –î–∞–∂–µ –µ—Å–ª–∏ `routerCache` —Å–±—Ä–æ—à–µ–Ω, –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ—Ç –∂–µ `pendingStore` –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π.
- –¢–µ—Å—Ç-–ø–æ–∫—Ä—ã—Ç–∏–µ: `apps/worker-main/features/broadcast/__tests__/telegram-broadcast-command.test.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–µ–π—Å `keeps pending broadcast after router cache reset`, –∫–æ—Ç–æ—Ä—ã–π –æ—á–∏—â–∞–µ—Ç `routerCache` –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—ã–∑–æ–≤–∞ –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞.
- –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞: –µ—Å–ª–∏ –∞–¥–º–∏–Ω —Å–Ω–æ–≤–∞ –≤–∏–¥–∏—Ç –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –≤–º–µ—Å—Ç–æ ¬´‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!¬ª, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ worker –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è –±–æ–ª–µ–µ 60 —Å–µ–∫—É–Ω–¥ ‚Äî TTL pending-—Å–µ—Å—Å–∏–∏ –ø—Ä–µ–∂–Ω–∏–π (`pendingTtlMs=60000`).

## –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç
1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `ADMIN_TG_IDS` —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å `GET /admin/access` —Å –≤–∞–ª–∏–¥–Ω—ã–º `x-admin-token`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ whitelisted ID –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ `whitelist`, –∞ `health` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `status: "ok"` –∏–ª–∏ –æ–±—ä—è—Å–Ω–∏–º—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ Telegram.
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å `TELEGRAM_BOT_TOKEN`.
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å KV `BROADCAST_PENDING_KV`: –∑–∞–ø—Ä–æ—Å–æ–º `wrangler kv:key list --namespace-id $BROADCAST_PENDING_KV --prefix broadcast:pending:` —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ namespace –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç ¬´–∑–∞–≤–∏—Å—à–∏—Ö¬ª –∫–ª—é—á–µ–π. –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å—Ç–∞—Ä—ã—Ö –∫–ª—é—á–µ–π —É–¥–∞–ª–∏—Ç—å –∏—Ö –∫–æ–º–∞–Ω–¥–æ–π `wrangler kv:key delete` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ä–∞—Å—Å—ã–ª–∫–∏.
   - (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–ª–∞–≥–æ–º `BROADCAST_ENABLED`: –∑–Ω–∞—á–µ–Ω–∏–µ `1`/`true` –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤–∫–ª—é—á—ë–Ω–Ω–æ–π, `0`/`false`
     –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏.
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è**
   - –û—Ç whitelisted –∞–∫–∫–∞—É–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `/broadcast` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´ping¬ª) ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å `/send`. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —á–∞—Ç–∞—Ö –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–µ–∑ `/send` —Ä–∞—Å—Å—ã–ª–∫–∞ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç.
   - –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —Å –Ω–µ-whitelisted –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏.
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç, —Ç–µ–∫—Å—Ç –∏–∑ 3970 —Å–∏–º–≤–æ–ª–æ–≤ (–ø—Ä–æ—Ö–æ–¥–∏—Ç), —Ç–µ–∫—Å—Ç –Ω–∞ 1 —Å–∏–º–≤–æ–ª –¥–ª–∏–Ω–Ω–µ–µ –ª–∏–º–∏—Ç–∞ (–æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π), –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥ –≤ –æ–∫–Ω–æ 1000‚ÄØ–º—Å (–±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –æ—à–∏–±–∫–æ–π ¬´–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ‚Ä¶¬ª –∏ –ø—Ä–æ—Å–∏—Ç /new_text).
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –°–º–æ—Ç—Ä–µ—Ç—å `wrangler tail` –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏; –æ—à–∏–±–∫–∏ Telegram –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–µ–≥–æ–º `[broadcast]`. –ï—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è `broadcast pool aborted`,
     —Ñ–∏–∫—Å–∏—Ä—É–µ–º `reason`, `retryAfterMs`, `status` –∏ —Å–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏–ª ¬´‚ùå –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞¬ª.
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—à—ë–ª –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—Å—Ç–∞ –∏ –∑–∞–ø—Ä–æ—Å `/send`, –∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—è–≤–∏–ª–æ—Å—å –≤ tail (—Å–æ–±—ã—Ç–∏–µ `broadcast send confirmed`).
   - –ü–æ—Å–ª–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∂—É—Ä–Ω–∞–ª (–¥–∞—Ç–∞, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π).
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `GET /admin/diag?q=broadcast` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ `delivered/failed/throttled429/durationMs`
     –∏ —Å—Ç–∞—Ç—É—Å–æ–º `ok` (–∏–ª–∏ `aborted`, –µ—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ –∑–∞—â–∏—Ç–∞). –û—à–∏–±–∫–∞ ¬´–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ‚Ä¶¬ª –¥–æ–ª–∂–Ω–∞ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ `text-gate_rejected`, —á—Ç–æ–±—ã –µ—ë –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏ —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–µ.

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ReferenceError (2025-11-27)
**–°–∏–º–ø—Ç–æ–º—ã**
- –õ—é–±–æ–π `POST /webhook/<secret>` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è `500 Internal Server Error`.
- –í tail Cloudflare –≤–∏–¥–Ω–æ `ReferenceError: createBroadcastDiagRoute is not defined` —Å–æ —Å—Ç–µ–∫–æ–º `createBroadcastDiagRoute3` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `create-admin-router`.
- `/admin/diag?q=broadcast` –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∞ `scripts/diagnose-telegram-webhook.sh` –≤—ã–≤–æ–¥–∏—Ç `referenceError=createBroadcastDiagRoute`.

**–®–∞–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏**
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å `./scripts/diagnose-telegram-webhook.sh <worker_url> <admin_token>` ‚Äî —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç `/admin/selftest`, `/admin/diag` –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ ReferenceError.
2. –°—á–∏—Ç–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ webhook —á–µ—Ä–µ–∑ `curl https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/getWebhookInfo` –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `last_error_message` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `500 Internal Server Error`.
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npx wrangler tail --env production --format pretty` –∏ –ø–æ–π–º–∞—Ç—å —Å—Ç–µ–∫ `createBroadcastDiagRoute3`, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ barrel-—Ñ–∞–π–ª `apps/worker-main/features/index.ts` –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `createBroadcastDiagRoute`.
4. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è barrel-—Ñ–∞–π–ª–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã: `diagnose-telegram-webhook`, `getWebhookInfo`, tail –∏ —Ä—É—á–Ω–æ–π –≤—ã–∑–æ–≤ `/admin/diag?q=broadcast`.

**–õ–æ–≥–∏ –∏ —Å—Å—ã–ª–∫–∏**
- –ü–æ–¥—Ä–æ–±–Ω—ã–π –∂—É—Ä–Ω–∞–ª: [`memory-bank/logs/diag-2025-11-27-broadcast-admin.md`](../logs/diag-2025-11-27-broadcast-admin.md).
- Tail-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç `memory-bank/logs/tail-2025-11-27-broadcast.txt` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π) –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `getWebhookInfo` –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –∫ –∂—É—Ä–Ω–∞–ª—É.
- –ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –∑–∞–ø–∏—Å—å –≤ `memory-bank/logs/` —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —Ä–µ—Ç–µ—Å—Ç–∞ `/admin/diag?q=broadcast`.

## Smoke-—Ç–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è webhook –∏ `/broadcast`
- –õ–æ–≥–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: [`memory-bank/logs/telegram-webhook-smoke-2025-11-27.md`](../logs/telegram-webhook-smoke-2025-11-27.md) —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —É—Å–ø–µ—à–Ω—ã–π `POST /webhook` –±–µ–∑ `ReferenceError`, —Å–æ–±—ã—Ç–∏–µ `[telegram-webhook]` –∏ –æ—Ç–ø—Ä–∞–≤–∫—É `sendTyping` –≤ –¥–∏–∞–ª–æ–≥–µ –∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `/broadcast`.
- –ù–æ–≤–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è: [`memory-bank/logs/telegram-webhook-smoke-2025-11-16.md`](../logs/telegram-webhook-smoke-2025-11-16.md) ‚Äî webhook –∏ –¥–∏–∞–ª–æ–≥ –æ—Ç–≤–µ—á–∞—é—Ç 200, –∫–æ–º–∞–Ω–¥–∞ `/broadcast` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –Ω–æ –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ—Ç (recipients=0 –∏–∑-–∑–∞ –ø—É—Å—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∞—É–¥–∏—Ç–æ—Ä–∏–∏).

### –ß–µ–∫-–ª–∏—Å—Ç smoke 2025-11-16
- Tail: `npx wrangler tail --env production --format pretty` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ—Å—Å–∏–∏.
- –°–æ–æ–±—â–µ–Ω–∏—è: `ping` ‚Üí `/broadcast` ‚Üí `smoke broadcast` —Å whitelisted –∞–∫–∫–∞—É–Ω—Ç–∞.
- –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ, —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ –Ω–µ—Ç (`recipients=0`, —Ñ–∏–ª—å—Ç—Ä—ã –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –ø—É—Å—Ç—ã–µ) ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π.

### –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç (–ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏ –ª—é–±–æ–º –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞)
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å tail: `npx wrangler tail --env production --format pretty` –∏ –Ω–∞–±–ª—é–¥–∞—Ç—å –≤—ã–≤–æ–¥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –æ–∫–Ω–µ/—Å–µ—Å—Å–∏–∏.
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ping`) –∏ –∫–æ–º–∞–Ω–¥—É `/broadcast` –∏–∑ whitelisted –∞–∫–∫–∞—É–Ω—Ç–∞.
3. –û–∂–∏–¥–∞–Ω–∏—è –≤ —Ö–≤–æ—Å—Ç–µ: —Å—Ç—Ä–æ—á–∫–∞ `[telegram-webhook]` —Å `chat_id_raw`/`chat_id`, –¥–∞–ª–µ–µ `[sendTyping]`, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `ReferenceError` –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π `status=200`.
4. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ö–≤–æ—Å—Ç –≤ `memory-bank/logs/telegram-webhook-smoke-<date>.md` –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –≤ —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—é
- –ö–∞–∂–¥–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `memory-bank/stable-builds.md` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º operational log) —Å –¥–∞—Ç–æ–π, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –∫—Ä–∞—Ç–∫–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è.
- –ü—Ä–∏ —Å–±–æ—è—Ö —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ª–æ–≥–æ–≤ `wrangler tail` –∏ –æ–ø–∏—Å–∞—Ç—å —à–∞–≥–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è. –ü—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ `waitUntil` –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–¥–∞—é—Ç –æ–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏.

## waitUntil –∏ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- Telegram-–∫–æ–º–∞–Ω–¥–∞ `/broadcast` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sender —Ä–∞—Å—Å—ã–ª–∫–∏ –Ω–∞–ø—Ä—è–º—É—é. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–∑—É –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É (`202 Accepted`) –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ `waitUntil`, —á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏—è —É—à–ª–∏ –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä—É—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `wrangler tail` –∏ –∏—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏ `admin broadcast delivered` / `admin broadcast failed`.
- –ï—Å–ª–∏ `waitUntil` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ unit-—Ç–µ—Å—Ç–∞—Ö), –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç sender, –Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Äî –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞.

## –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- **–õ–æ–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞—á–∏ 6. üì£ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏.** –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø—Ä–æ–≥–æ–Ω–æ–≤ HTTP –∏ broadcast suite:

```bash
cd ~/Projects/tg-responcer
export WORKER_BASE_URL="https://tg-responcer.egormob.workers.dev"
export ADMIN_TOKEN="devadmintoken"

ts="$(date +%Y%m%d-%H%M%S)"
mkdir -p logs reports

set -u -o pipefail

CI=1 npm run test -- http | tee "logs/test-http-$ts.log" >/dev/null
http_exit="${PIPESTATUS[0]}"
zip -j "logs/test-http-latest.zip" "logs/test-http-$ts.log" >/dev/null

CI=1 npm run test -- broadcast | tee "logs/test-broadcast-$ts.log" >/dev/null
br_exit="${PIPESTATUS[0]}"
zip -j "logs/test-broadcast-latest.zip" "logs/test-broadcast-$ts.log" >/dev/null

http_log="logs/test-http-$ts.log"
br_log="logs/test-broadcast-$ts.log"

field() { grep -m1 "$1" "$2" | sed 's/^ *//'; }

http_files="$(field 'Test Files' "$http_log")"
http_tests="$(field '^ *Tests' "$http_log")"
http_duration="$(field '^ *Duration' "$http_log")"

br_files="$(field 'Test Files' "$br_log")"
br_tests="$(field '^ *Tests' "$br_log")"
br_duration="$(field '^ *Duration' "$br_log")"

# –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–∏–∞–ª–æ–≥–∞
req1="$(grep -i -c 'passes admin command to dialog when handler is missing' "$http_log" "$br_log" 2>/dev/null || true)"
req2="$(grep -i -c 'continues dialog when admin command handler returns undefined' "$http_log" "$br_log" 2>/dev/null || true)"
req3="$(grep -i -c 'continues dialog when broadcast command access is denied' "$http_log" "$br_log" 2>/dev/null || true)"
req4="$(grep -i -c 'routes dialog after broadcast command is followed by admin status' "$http_log" "$br_log" 2>/dev/null || true)"
req5="$(grep -i -c 'sends broadcast via telegram command and confirms delivery' "$http_log" "$br_log" 2>/dev/null || true)"
req6="$(grep -i -c 'broadcast sent via telegram command' "$http_log" "$br_log" 2>/dev/null || true)"

ok_http="$([ "$http_exit" = "0" ] && echo OK || echo FAIL)"
ok_br="$([ "$br_exit" = "0" ] && echo OK || echo FAIL)"

all_reqs="$([ "$req1" -gt 0 ] && [ "$req2" -gt 0 ] && [ "$req3" -gt 0 ] && [ "$req4" -gt 0 ] && [ "$req5" -gt 0 ] && [ "$req6" -gt 0 ] && echo OK || echo WARN)"

report="reports/REPORT-Task6-unblock-dialog-from-broadcast-$ts.md"
{
  echo "# 6. üì£ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ ‚Äî –æ—Ç—á—ë—Ç –ø—Ä–æ–≥–æ–Ω–∞"
  echo
  echo "- –î–∞—Ç–∞: $(date '+%d.%m.%Y, %H:%M')"
  echo "- Worker: $WORKER_BASE_URL"
  echo
  echo "## HTTP suite ($ok_http)"
  echo "- $http_files"
  echo "- $http_tests"
  echo "- $http_duration"
  echo
  echo "## Broadcast suite ($ok_br)"
  echo "- $br_files"
  echo "- $br_tests"
  echo "- $br_duration"
  echo
  echo "## –ü—Ä–∏–∑–Ω–∞–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–∏–∞–ª–æ–≥–∞ (–¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)"
  echo "- passes admin command to dialog when handler is missing: $req1"
  echo "- continues dialog when admin command handler returns undefined: $req2"
  echo "- continues dialog when broadcast command access is denied: $req3"
  echo "- routes dialog after broadcast command is followed by admin status: $req4"
  echo "- sends broadcast via telegram command and confirms delivery: $req5"
  echo "- broadcast sent via telegram command: $req6"
  echo
  echo "## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã"
  echo "- logs/test-http-latest.zip"
  echo "- logs/test-broadcast-latest.zip"
  echo "- $http_log"
  echo "- $br_log"
  echo
  if [ "$ok_http" = "OK" ] && [ "$ok_br" = "OK" ] && [ "$all_reqs" = "OK" ]; then
    echo "## –ò—Ç–æ–≥"
    echo "‚úÖ –î–∏–∞–ª–æ–≥ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏: —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç."
  else
    echo "## –ò—Ç–æ–≥"
    echo "‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ—Ç–∞–ª–∏: ok_http=$ok_http, ok_broadcast=$ok_br, key_signals=$all_reqs. –ï—Å–ª–∏ –µ—Å—Ç—å WARN/FAIL ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏ –∏ —Å–≤–µ—Ä–∏—Ç—å –∫–µ–π—Å—ã."
  fi
} > "$report"

echo "$report"
tail -n +1 "$report"
```

## –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∑—ã–≤
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏: –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
- –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram (—Å–º. [`memory-bank/references/telegram-broadcast.md`](../references/telegram-broadcast.md)).

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- –û—Ü–µ–Ω–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—â–∏—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π) –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏ (MVP)

### –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ
- –ò—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π: –≤—ã–±–æ—Ä–∫–∞ D1 (`users`) ‚Üí fallback none.
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏: `broadcast recipients resolved` (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `source`/`recipients`), `broadcast pool initialized`, —Å—Ç–∞—Ç—É—Å—ã Telegram –æ—Ç–ø—Ä–∞–≤–æ–∫.
- –ß–µ–∫–ø–æ–∏–Ω—Ç—ã –º–µ—Ç—Ä–∏–∫: –Ω–∞–ª–∏—á–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π, –ª–æ–≥ `broadcast recipients resolved`, `recipients>0`, `broadcast pool initialized`, —Å—Ç–∞—Ç—É—Å—ã Telegram (`sendText`/`sendTyping`).

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –§–ª–∞–≥ `BROADCAST_ENABLED` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –∫–æ–º–∞–Ω–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞, –¥–∏–∞–ª–æ–≥ `/broadcast ‚Üí –ø–æ–¥—Å–∫–∞–∑–∫–∞ ‚Üí —Ç–µ–∫—Å—Ç` —Ä–∞–±–æ—Ç–∞–µ—Ç.
- –õ–æ–≥–∏ `broadcast recipients resolved` –∏ `broadcast pool initialized` –ø–∏—à—É—Ç—Å—è —Å `source=d1` –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º (`recipients>0`).
- –ü—É–ª sender‚Äô–æ–≤ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `broadcast pool completed`/`admin broadcast delivered` —Å –Ω–µ–Ω—É–ª–µ–≤–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π; Telegram-—Å—Ç–∞—Ç—É—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º.
- –°–≤–µ–∂–∏–µ —Ö–≤–æ—Å—Ç—ã webhook –∏ `/broadcast`: [`memory-bank/logs/diag-2025-11-30-broadcast-webhook.md`](../logs/diag-2025-11-30-broadcast-webhook.md#tail-—É—Å–ø–µ—à–Ω–æ–≥–æ-webhook-–∏-broadcast) —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —É—Å–ø–µ—à–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ D1.
