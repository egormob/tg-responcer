# Problem 2025-12-21 — admin webhook non-2xx

## Проблема
- Некорректные аргументы в админской команде (пример `/export 16.12.2025"`) приводят к non-2xx ответу из webhook.
- Telegram начинает бесконечно ретраить такой апдейт, блокируя очередь, и бот перестает отвечать.

## Технические причины / гипотезы
- `handleAdminCommand` возвращает `Response` напрямую в webhook.
- Ошибки админ-команд (`/export`, `/broadcast` и др.) возвращают 4xx/5xx.
- Telegram ретраит non-2xx на webhook и «держит» очередь.

## План решения
- Нормализовать ответы админ-команд на границе webhook: любые non-2xx превращать в 200 OK, сохраняя логирование.
- Обернуть `handleAdminCommand` в `try/catch`, чтобы исключения также приводили к 200 OK.
- Проверка согласованности: пользовательский поток и `/admin/export` HTTP-роут не затрагиваются.

## Проверки
- [x] Unit: telegram-webhook нормализует non-2xx admin response в 200.
- [ ] Smoke: (опционально) отправить `/export` с неверной датой и подтвердить 200 OK в tail/diag.

## Повторные попытки
- Дата / вывод: нет.

## Итоги
- Добавлена нормализация non-2xx ответов админ-команд в webhook и защита от исключений в хендлере.
- Добавлен и пройден unit-тест для нормализации non-2xx ответов.
- Статус: решено
