# Проблема: пауза между индикатором «Печатает…» и сообщением бота

**Источник:** обратная связь заказчика от 2025-11-13.

> «При ответе бота индикация "Печатает" гаснет, затем возникает довольно длительная пауза, затем пользователю приходит ответ. Пауза довольно длительная и возникает ощущение, что бот завис, сломался или собеседник на той стороне передумал и решил не отвечать. Это может привести к преждевременному закрытию диалога до получения ответа. Нужно убрать эту паузу, чтобы сразу после прекращения индикации приходил ответ, либо индикация печатает прекращалась при отправке ответа. Сделать это надо максимально эргономичным и эффективным путем для системы.»

## Гипотезы
- Индикация `sendTyping` отключается до того, как Responses завершает подготовку текста, и адаптер Telegram ждёт несколько секунд перед `sendText`.
- Возможна блокировка на стороне Telegram API (удержание long-polling), требуются логи `sendText` и `sendTyping` с timestamp.

## План
1. Собрать тайминги `sendTyping`/`sendText` и ответа OpenAI (`response_id`, задержка).
2. Проверить, не происходит ли повторная отправка `sendTyping` после подготовки ответа.
3. При необходимости изменить менеджер typing-индикации: задержать отключение до фактической отправки ответа или отправлять сообщение сразу после прекращения typing.
4. Добавить автотест/протокол ручной проверки с контролем задержки.

## Статус
- ✅ Исправлено в рамках М3.Ш5: `createTypingIndicator` теперь удерживает индикатор с повторной отправкой `sendTyping` до завершения ответа и покрыт автотестами (`npm test -- --run apps/worker-main/http/__tests__/typing-indicator.test.ts`).
