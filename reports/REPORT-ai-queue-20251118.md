# REPORT ‚Äî AI queue stress smoke (2025-11-18)

## –ö–æ–Ω—Ç—É—Ä –∏ —Ü–µ–ª—å
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ–≥–æ–Ω `GET /admin/d1-stress` —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º `STRESS_TEST_ENABLED=1`.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏ –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–∏–∞–ª–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º—è–≥–∫–æ–π –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏.
- –°–±–æ—Ä —Å–Ω–∏–º–∫–∞ `/admin/diag?q=ai-queue` –¥–æ/–≤–æ –≤—Ä–µ–º—è/–ø–æ—Å–ª–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ª–∏–º–∏—Ç–æ–≤ —Å –∫–æ–Ω—Ñ–∏–≥–æ–º.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| –ò—Å—Ç–æ—á–Ω–∏–∫ –ª–∏–º–∏—Ç–æ–≤ | –¥–µ—Ñ–æ–ª—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞ (KV –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, `kvConfig:null`) |
| `maxConcurrency` / `maxQueue` | 4 / 64 |
| `requestTimeoutMs` | 12‚ÄØ000‚ÄØ–º—Å (OpenAI Responses) |
| Retries | —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–ª—è –∞–¥–∞–ø—Ç–µ—Ä–∞ Responses; `max_retries_exceeded` –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | `wrangler tail --format=pretty`, `/admin/diag?q=ai-queue`, —Ä—É—á–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ |

## –ù–∞–±–ª—é–¥–µ–Ω–∏—è
1. **–û—á–µ—Ä–µ–¥—å –∏ –ª–∏–º–∏—Ç–µ—Ä**
   - `/admin/diag?q=ai-queue`: `active` ‚â§ 1, `queued=0`, `droppedSinceBoot=0`, `avgWaitMs=0`, `lastDropAt=null` –Ω–∞ –≤—Å–µ—Ö —Å—Ä–µ–∑–∞—Ö.
   - –í—Å–µ `[ai][config]` –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `kvConfig:null`, –ø–æ—ç—Ç–æ–º—É `AI_QUEUE_CONFIG` –∏–∑ `AI_CONTROL_KV` –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è.
2. **OpenAI Responses**
   - –ü—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è `(warn) [ai][retry] ‚Ä¶ 'OpenAI Responses request timed out'` –∏ `(error) [ai][timeout]`.
  - –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∑–∞–≥–ª—É—à–∫–∞–º `–Ø –Ω–∞ —Å–µ–∫—É–Ω–¥—É –æ—Ç–≤–ª–µ–∫—Å—è... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—â—ë —Ä–∞–∑ üîÅüí¨`, –Ω–æ –ø–æ—Å–ª–µ —Å–Ω—è—Ç–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–≤–µ—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.
3. **D1 —Å—Ç—Ä–µ—Å—Å-—Ä—É—á–∫–∞**
   - `max_retries_exceeded` –Ω–µ –Ω–∞–±–ª—é–¥–∞–ª–∏—Å—å; —Ä–µ—Ç—Ä–∞–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã.

## –ú–µ—Ç—Ä–∏–∫–∏ –º—è–≥–∫–∏—Ö –æ—Ç–∫–∞–∑–æ–≤
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ –Ω–µ—Ç. –ü–æ tail-–ª–æ–≥—É –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–µ: ~30‚Äì40‚ÄØ% –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ ‚â§20‚ÄØ% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –∑–∞–≥–ª—É—à–∫–æ–π, –≤—Å–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –°—Ç–∞—Ç—É—Å `d1-stress`
- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ö–æ–¥ –∑–∞–≤–µ—Ä—à—ë–Ω, –æ—á–µ—Ä–µ–¥—å –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è.
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É –ª–∏–º–∏—Ç–æ–≤ (`AI_CONTROL_KV`) –∏ —Ç–∞–π–º–∞—É—Ç–∞–º OpenAI Responses.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —á—Ç–µ–Ω–∏–µ `AI_QUEUE_CONFIG` –∏–∑ `AI_CONTROL_KV` –∏ –∑–∞–¥–∞—Ç—å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `8/128`).
2. –õ–∏–±–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `requestTimeoutMs`/`retryMax`, —á—Ç–æ–±—ã —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —á–∏—Å–ª–æ soft-fail –ø—Ä–∏ –ø–∏–∫–∞—Ö.
3. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∂—É—Ä–Ω–∞–ª.

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- `memory-bank/logs/stress-test-2025-11-17-ai-queue.md` ‚Äî —Ä–µ—Ç–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ ¬´2025-11-18¬ª —Å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏.
- `RoadMap.md` ‚Äî —Å—Ç–∞—Ç—É—Å —à–∞–≥–∞ 4.4 –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç–µ–∫—É—â–∏—Ö –ª–∏–º–∏—Ç–æ–≤.
